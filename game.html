<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Game - Card Selection</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Card Selection Modal -->
    <div class="card-selection-modal" id="cardSelectionModal">
        <div class="card-modal-content">
            <h2>Select Your Card Type</h2>
            <p>Choose from 400 card types with different winning probabilities. Taken cards are marked in red.</p>

            <!-- Countdown element -->
            <div id="cardSelectionCountdown" style="display: none;
                background: rgba(255,255,255,0.1);
                padding: 10px;
                border-radius: 5px;
                margin: 10px 0;
                text-align: center;
                font-weight: bold;
                color: #ffcc00;">
                Game starting in 20 seconds
            </div>

            <div class="card-grid" id="cardGrid">
                <!-- Card options will be generated by JavaScript -->
            </div>

            <div class="pagination">
                <button class="page-btn" id="prevPageBtn" disabled>
                    <i class="fas fa-chevron-left"></i> Prev
                </button>
                <span id="pageInfo">Page 1 of 34</span>
                <button class="page-btn" id="nextPageBtn">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div>
                <button class="modal-btn" id="randomCardBtn">Select Random Card</button>
                <button class="modal-btn success" id="startGameBtn">Start Game</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Header with Title, Balance and Stats -->
        <div class="header">
            <div class="header-top">
                <div class="game-title">BINGO BONANZA</div>
                <div class="balance-display">
                    <i class="fas fa-coins"></i>
                    <span id="mainBalanceAmount">500.00</span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-title"><i class="fas fa-users"></i> Players</div>
                    <div class="stat-value" id="playerCount">0</div>
                    <div class="stat-detail">In Game</div>
                </div>

                <div class="stat-box">
                    <div class="stat-title"><i class="fas fa-trophy"></i> Prize</div>
                    <div class="stat-value" id="prizePool">0</div>
                    <div class="stat-detail">Birr</div>
                </div>

                <div class="stat-box">
                    <div class="stat-title"><i class="fas fa-ticket-alt"></i> Entry</div>
                    <div class="stat-value" id="entryFee">10</div>
                    <div class="stat-detail">Birr/Game</div>
                </div>

                <div class="stat-box">
                    <div class="stat-title"><i class="fas fa-hashtag"></i> Current</div>
                    <div class="stat-value" id="currentNumberMini">-</div>
                    <div class="stat-detail">Number</div>
                </div>
            </div>
        </div>

        <!-- Game Container -->
        <div class="game-container">
            <div class="bingo-section">
                <div class="bingo-header">
                    <div class="bingo-header-cell b">B</div>
                    <div class="bingo-header-cell i">I</div>
                    <div class="bingo-header-cell n">N</div>
                    <div class="bingo-header-cell g">G</div>
                    <div class="bingo-header-cell o">O</div>
                </div>
                <div class="bingo-card" id="bingoCard">
                    <!-- Bingo cells will be generated by JavaScript -->
                </div>
            </div>

            <div class="game-controls">
                <div class="current-number">
                    <h3><i class="fas fa-star"></i> Current</h3>
                    <div class="number-display" id="currentNumber">-</div>
                </div>

                <div class="called-numbers">
                    <h3><i class="fas fa-list"></i> Called</h3>
                    <div class="numbers-list" id="calledNumbers">
                        <!-- Called numbers will appear here -->
                    </div>
                </div>
            </div>

            <div class="game-info" id="gameInfo">
                Mark numbers as they are called!
            </div>
        </div>
    </div>

    <!-- Fixed Bingo Button -->
    <div class="bingo-button-container">
        <button class="bingo-main-button" id="bingoMainButton">
            <i class="fas fa-trophy"></i> BINGO
        </button>
    </div>

    <!-- Win Modal -->
    <div class="modal" id="winModal">
        <div class="modal-content">
            <h2>BINGO! You Win!</h2>
            <p>Congratulations! You've completed a winning pattern!</p>
            <p>You've won <span id="winAmount">0</span> Birr!</p>
            <div class="countdown" id="countdown">5</div>
            <p>New game starting in <span id="countdownText">5</span> seconds</p>
        </div>
    </div>

    <!-- Load Socket.io and script.js -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>

    <!-- Login check and user data initialization -->
    <script>
        // Check if user is logged in and has selected a game
        const sessionId = localStorage.getItem('sessionId');
        const username = localStorage.getItem('username');
        const userBalance = localStorage.getItem('balance');
        const userPhone = localStorage.getItem('phone');
        const currentGame = localStorage.getItem('currentGame');

        // Redirect to login if not authenticated
        if (!sessionId || !username) {
            window.location.href = '/login.html';
        }

        // Redirect to lobby if no game selected
        if (!currentGame) {
            window.location.href = '/lobby.html';
        }

        // Set the user's balance from localStorage
        const balanceEl = document.getElementById('balanceAmount');
        const mainBalanceEl = document.getElementById('mainBalanceAmount');

        if (balanceEl) {
            balanceEl.textContent = (parseFloat(userBalance) || 500).toFixed(2);
        }
        if (mainBalanceEl) {
            mainBalanceEl.textContent = (parseFloat(userBalance) || 500).toFixed(2);
        }

        // Set the username in the menu
        const menuUsernameEl = document.getElementById('menuUsername');
        if (menuUsernameEl) {
            menuUsernameEl.textContent = username;
        }

        // Set the entry fee
        const gameData = JSON.parse(currentGame);
        const entryFeeEl = document.getElementById('entryFee');
        if (entryFeeEl) {
            entryFeeEl.textContent = gameData.entryFee || 10;
        }
    </script>
</body>
</html>